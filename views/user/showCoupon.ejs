<%-include('../partials/userHeader') %>

<script>
     
    
    
        function copyToClipboard(couponCode, couponId) {
            const el = document.createElement('textarea');
            el.value = couponCode;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            const copyText = document.getElementById('copyText' + couponId);
            if (copyText) {
                copyText.textContent = 'Coupon Code Copied!';
            }
        }
    </script>
   

<div class="container-fluid">
    <div class="row p-5">
        <div class="d-flex justify-content-center">    
                <h1>Coupons</h1>
        </div>
        <% coupon.forEach((coupons) => { %>
            <% if (coupons.couponType === 'public') { %>
            <div class="col-md-4 p-3">
                <div class="card text-center">
                    <div class="card-header">
                        <%= coupons.couponName %>
                    </div>
                    <div class="image-container p-3">
                        <img src="/assets/offerimage.svg" alt="no image" style="height: 150px;">
                       </div>
                    <div class="card-body">
                        <h5 class="card-title">Coupon Code: <%= coupons.couponCode %></h5>
                        <p class="card-text" id="copyText<%= coupons._id %>">Copy Coupon Code</p>
                        <button class="btn btn-primary" onclick="copyToClipboard('<%= coupons.couponCode %>', '<%= coupons._id %>')">Copy Code</button>
                        <!-- Button to trigger the modal -->
                        <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#couponModal<%= coupons._id %>">Terms & Conditions</button>
                    </div>
                    <div class="card-footer text-muted">
                        <% if (date < coupons.endDate) { %>
                            <% let dte = new Date(coupons.endDate) %>
                            <p class="card-text">EXPIRES ON: <%= dte.getDate() %>/<%= dte.getMonth() + 1 %>/<%= dte.getFullYear() %> </p>
                        <% } else { %>
                            <% let de = new Date(coupons.endDate) %>
                            <p class="card-text text-danger">EXPIRED ON: <%= de.getDate() %>/<%= de.getMonth() + 1 %>/<%= de.getFullYear() %> </p>
                        <% } %>
                    </div>
                </div>
            </div>

            <!-- Modal -->
            <div class="modal fade" id="couponModal<%= coupons._id %>" tabindex="-1" aria-labelledby="couponModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="couponModalLabel">Coupon Details</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                           
                            <p>Coupon Name: <%= coupons.couponName %></p>
                            <p>Coupon Code: <%= coupons.couponCode %></p>
                            <p>Discount Type: <%= coupons.discountType%></p>
                            <p>Limit(coupon per user): <%= coupons.limit%> </p>
                            <p>Start Date: 
                              <% let dt=new Date(coupons.startDate)%>
                              <%=dt.getDate()%>/<%=dt.getMonth()+1%>/<%=dt.getFullYear()%>  %>
                            </p>
                            <p>Expires On:
                              <% let dte=new Date(coupons.endDate)%>
                              <%=dte.getDate()%>/<%=dte.getMonth()+1%>/<%=dte.getFullYear()%>  %>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <% } %>
        <% }); %>
    </div>
</div>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<%-include('../partials/userFooter') %>
